"use strict";(globalThis["webpackChunkalarm_light_kittens"]=globalThis["webpackChunkalarm_light_kittens"]||[]).push([[648],{1648:(e,t,l)=>{l.r(t),l.d(t,{default:()=>U});l(939),l(7049),l(1746),l(4635);var a=l(1347),o=l(8633),n=l(7763),r=l(4187),i=l(4495),s=l.n(i),c=l(3022);const u={class:"row justify-center"},d={class:"col-12 col-xl-10"},m={class:"row q-col-gutter-lg"},g={class:"col-12 col-md-4"},p={class:"text-h6 text-primary flex items-center q-mb-md"},v={class:"q-gutter-y-md"},b={class:"row q-col-gutter-sm"},k={class:"col-6"},f={class:"col-6"},h={class:"row q-gutter-sm justify-center q-mt-md"},x={class:"text-subtitle2 q-mb-sm text-grey-8"},y={class:"col-12 col-md-8"},_={class:"text-h6 text-primary flex items-center"},F="longan_geocode_cache",w={__name:"IndexPage",setup(e){const t=(0,c.A)(),l=(0,r.KR)(""),i=(0,r.KR)(""),w=(0,r.KR)(""),L=(0,r.KR)(""),q=(0,r.KR)(!1),A=(0,r.KR)(null),V=(0,r.KR)(null),Q=(0,r.Kh)({}),S=(0,a.EW)(()=>Object.keys(Q).sort().map(e=>({name:e,lat:Q[e].lat,lng:Q[e].lng,marker:Q[e].marker}))),C=s().icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",shadowSize:[41,41]}),N=[{name:"อาคารที่ 1",lat:18.758769,lng:99.014645},{name:"อาคารที่ 2",lat:18.758914,lng:99.015257},{name:"อาคารที่ 3",lat:18.758361,lng:99.015129},{name:"อาคารที่ 4",lat:18.757983,lng:99.015512},{name:"อาคารที่ 5",lat:18.758168,lng:99.015763},{name:"อาคารที่ 6",lat:18.757394,lng:99.015381},{name:"อาคารที่ 7",lat:18.75759,lng:99.015905},{name:"สนามฟุตซอล",lat:18.757955,lng:99.015097},{name:"สนามหญ้าจริง (safe zone)",lat:18.757826,lng:99.014679},{name:"สนามบาสเก็ดบอล",lat:18.757833,lng:99.015761}];function I(){A.value=s().map("map").setView([18.8,99],8),s().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(A.value),V.value=s().layerGroup().addTo(A.value),N.forEach(e=>{W(e.name,e.lat,e.lng,!1)})}function W(e,t,l,a=!1){if(!e||isNaN(t)||isNaN(l))return;const o=e.trim();if(Q[o]){const e=Q[o].marker;e.setLatLng([t,l]),e.setPopupContent(j(o,t,l)),Q[o].lat=t,Q[o].lng=l}else{const e=s().marker([t,l],{icon:C}).addTo(V.value);e.bindPopup(j(o,t,l)),e.on("click",()=>{e.openPopup()}),Q[o]={lat:t,lng:l,marker:(0,r.IG)(e)}}K(),a&&A.value&&(A.value.flyTo([t,l],17,{duration:.8}),Q[o]&&Q[o].marker&&setTimeout(()=>{Q[o].marker.openPopup()},800))}function j(e,t,l){return`<div>\n             <div style="font-weight: 600; font-size: 14px; margin-bottom: 4px;">${e}</div>\n             <div style="font-size: 12px; color: #666;">\n               Lat: ${t.toFixed(6)}<br>Lng: ${l.toFixed(6)}\n             </div>\n           </div>`}function K(){const e=Object.values(Q);if(0===e.length||!A.value)return;const t=s().featureGroup(e.map(e=>e.marker));1===e.length?A.value.setView(t.getBounds().getCenter(),17):A.value.fitBounds(t.getBounds().pad(.2))}function R(){l.value&&""!==i.value&&""!==w.value?(W(l.value,Number(i.value),Number(w.value),!0),t.notify({color:"positive",message:`บันทึก "${l.value}" เรียบร้อยแล้ว`,icon:"check_circle"})):t.notify({color:"negative",message:"กรุณากรอกชื่อสถานที่ และ Latitude/Longitude ให้ครบถ้วน",icon:"warning"})}function T(){l.value="",i.value="",w.value="",L.value=""}function M(e){A.value&&(A.value.flyTo([e.lat,e.lng],17,{duration:.7}),e.marker&&e.marker.openPopup())}async function P(){const e=L.value.trim();if(e){q.value=!0;try{const l=await O(e);l?(i.value=Number(l.lat.toFixed(6)),w.value=Number(l.lng.toFixed(6)),A.value&&A.value.flyTo([l.lat,l.lng],15,{duration:.8}),t.notify({color:"positive",message:"พบตำแหน่งแล้ว",icon:"check"})):t.notify({color:"negative",message:"ไม่พบพิกัดจากที่อยู่นี้",icon:"error"})}catch(e){console.error(e),t.notify({color:"negative",message:"เกิดข้อผิดพลาดในการเชื่อมต่อ",icon:"error"})}finally{q.value=!1}}else t.notify({color:"warning",message:"กรุณากรอกที่อยู่สำหรับค้นหา",icon:"search"})}async function O(e){let t={};try{const e=localStorage.getItem(F);e&&(t=JSON.parse(e)||{})}catch(e){t={}}if(t[e])return t[e];const l="https://nominatim.openstreetmap.org/search?format=jsonv2&limit=1&q="+encodeURIComponent(e),a=await fetch(l,{headers:{Accept:"application/json"}});if(!a.ok)throw new Error("Geocoding error");const o=await a.json();if(!o||0===o.length)return null;const n=parseFloat(o[0].lat),r=parseFloat(o[0].lon);t[e]={lat:n,lng:r};try{localStorage.setItem(F,JSON.stringify(t))}catch(e){}return{lat:n,lng:r}}return(0,a.sV)(()=>{I()}),(e,t)=>{const r=(0,a.g2)("q-badge"),s=(0,a.g2)("q-icon"),c=(0,a.g2)("q-input"),F=(0,a.g2)("q-btn"),A=(0,a.g2)("q-card-section"),V=(0,a.g2)("q-separator"),Q=(0,a.g2)("q-item-section"),C=(0,a.g2)("q-item"),N=(0,a.g2)("q-item-label"),I=(0,a.g2)("q-list"),W=(0,a.g2)("q-scroll-area"),j=(0,a.g2)("q-card"),K=(0,a.g2)("q-page"),O=(0,a.gN)("ripple");return(0,a.uX)(),(0,a.Wv)(K,{class:"q-pa-md bg-grey-2"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",u,[(0,a.Lk)("div",d,[t[11]||(t[11]=(0,a.Lk)("h1",{class:"text-h4 text-center text-weight-bold q-mb-xs text-primary"},"กำหนดสถานที่ปลอดภัย",-1)),t[12]||(t[12]=(0,a.Lk)("p",{class:"text-subtitle1 text-center text-grey-7 q-mb-lg"},"โรงเรียนวารีเชียงใหม่ (Northern Thailand)",-1)),(0,a.Lk)("div",m,[(0,a.Lk)("div",g,[(0,a.bF)(j,{class:"my-card q-mb-md"},{default:(0,a.k6)(()=>[(0,a.bF)(A,null,{default:(0,a.k6)(()=>[(0,a.Lk)("div",p,[(0,a.bF)(r,{color:"primary",class:"q-mr-sm text-subtitle2"},{default:(0,a.k6)(()=>[...t[4]||(t[4]=[(0,a.eW)("1",-1)])]),_:1}),t[5]||(t[5]=(0,a.eW)(" ฟอร์มบันทึกตำแหน่ง (Marker Form) ",-1))]),(0,a.Lk)("div",v,[(0,a.bF)(c,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),label:"ชื่อสถานที่ / อาคาร",placeholder:"เช่น อาคารที่ 1",outlined:"",dense:"","bg-color":"white",rules:[e=>!!e||"กรุณากรอกชื่อสถานที่"]},{prepend:(0,a.k6)(()=>[(0,a.bF)(s,{name:"place"})]),_:1},8,["modelValue","rules"]),(0,a.Lk)("div",b,[(0,a.Lk)("div",k,[(0,a.bF)(c,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),modelModifiers:{number:!0},type:"number",label:"Latitude",placeholder:"18.xxxx",outlined:"",dense:"","bg-color":"white",step:"0.000001"},null,8,["modelValue"])]),(0,a.Lk)("div",f,[(0,a.bF)(c,{modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=e=>w.value=e),modelModifiers:{number:!0},type:"number",label:"Longitude",placeholder:"99.xxxx",outlined:"",dense:"","bg-color":"white",step:"0.000001"},null,8,["modelValue"])])]),(0,a.bF)(c,{modelValue:L.value,"onUpdate:modelValue":t[3]||(t[3]=e=>L.value=e),label:"ค้นหาจากชื่อที่อยู่ (Geocoding)",placeholder:"เช่น โรงเรียนวารี",outlined:"",dense:"","bg-color":"white",onKeyup:(0,o.jR)(P,["enter"]),hint:"ใช้บริการ Nominatim (OpenStreetMap)"},{append:(0,a.k6)(()=>[(0,a.bF)(F,{flat:"",round:"",color:"primary",icon:"search",onClick:P,loading:q.value},null,8,["loading"])]),_:1},8,["modelValue"]),(0,a.Lk)("div",h,[(0,a.bF)(F,{unelevated:"",color:"secondary","text-color":"white",icon:"my_location",label:"ค้นหาพิกัด",onClick:P,loading:q.value,class:"col-auto"},null,8,["loading"]),(0,a.bF)(F,{unelevated:"",color:"positive",icon:"add_location_alt",label:"เพิ่ม/อัปเดต",onClick:R,class:"col-auto"}),(0,a.bF)(F,{outline:"",color:"grey-7",label:"ล้างค่า",onClick:T,class:"col-auto"})])])]),_:1}),(0,a.bF)(V),(0,a.bF)(A,null,{default:(0,a.k6)(()=>[(0,a.Lk)("div",x," รายการ Marker ("+(0,n.v_)(S.value.length)+") ",1),(0,a.bF)(W,{style:{height:"250px"}},{default:(0,a.k6)(()=>[(0,a.bF)(I,{separator:"",bordered:"",class:"rounded-borders bg-white"},{default:(0,a.k6)(()=>[0===S.value.length?((0,a.uX)(),(0,a.Wv)(C,{key:0},{default:(0,a.k6)(()=>[(0,a.bF)(Q,{class:"text-center text-grey text-italic"},{default:(0,a.k6)(()=>[...t[6]||(t[6]=[(0,a.eW)(" ยังไม่มีข้อมูล ",-1)])]),_:1})]),_:1})):(0,a.Q3)("",!0),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(S.value,e=>(0,a.bo)(((0,a.uX)(),(0,a.Wv)(C,{key:e.name,clickable:"",onClick:t=>M(e)},{default:(0,a.k6)(()=>[(0,a.bF)(Q,{avatar:""},{default:(0,a.k6)(()=>[(0,a.bF)(s,{name:"push_pin",color:"green-6"})]),_:1}),(0,a.bF)(Q,null,{default:(0,a.k6)(()=>[(0,a.bF)(N,{class:"text-weight-medium"},{default:(0,a.k6)(()=>[(0,a.eW)((0,n.v_)(e.name),1)]),_:2},1024),(0,a.bF)(N,{caption:""},{default:(0,a.k6)(()=>[(0,a.eW)((0,n.v_)(e.lat.toFixed(5))+", "+(0,n.v_)(e.lng.toFixed(5)),1)]),_:2},1024)]),_:2},1024),(0,a.bF)(Q,{side:""},{default:(0,a.k6)(()=>[(0,a.bF)(s,{name:"chevron_right",color:"grey-4"})]),_:1})]),_:2},1032,["onClick"])),[[O]])),128))]),_:1})]),_:1})]),_:1})]),_:1})]),(0,a.Lk)("div",y,[(0,a.bF)(j,{class:"my-card fit"},{default:(0,a.k6)(()=>[(0,a.bF)(A,{class:"q-pb-none"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",_,[(0,a.bF)(r,{color:"primary",class:"q-mr-sm text-subtitle2"},{default:(0,a.k6)(()=>[...t[7]||(t[7]=[(0,a.eW)("2",-1)])]),_:1}),t[8]||(t[8]=(0,a.eW)(" แผนที่ (LeafletJS + OSM) ",-1))]),t[9]||(t[9]=(0,a.Lk)("p",{class:"text-caption text-grey-7 q-ma-none"}," คลิกที่ Marker เพื่อดูรายละเอียด (Popup) ",-1))]),_:1}),(0,a.bF)(A,null,{default:(0,a.k6)(()=>[...t[10]||(t[10]=[(0,a.Lk)("div",{id:"map",class:"rounded-borders shadow-1",style:{height:"600px",width:"100%","z-index":"1"}},null,-1)])]),_:1})]),_:1})])]),t[13]||(t[13]=(0,a.Lk)("div",{class:"text-center q-mt-lg text-caption text-grey"}," Program by Vue.js & Quasar Framework | Leaflet.js | OpenStreetMap ",-1))])])]),_:1})}}};var L=l(2968),q=l(5013),A=l(3341),V=l(222),Q=l(8155),S=l(6067),C=l(3933),N=l(1244),I=l(6915),W=l(5460),j=l(3766),K=l(2589),R=l(4958),T=l(9039),M=l(4028),P=l(272),O=l.n(P);const z=(0,L.A)(w,[["__scopeId","data-v-8819b1e8"]]),U=z;O()(w,"components",{QPage:q.A,QCard:A.A,QCardSection:V.A,QBadge:Q.A,QInput:S.A,QIcon:C.A,QBtn:N.A,QSeparator:I.A,QScrollArea:W.A,QList:j.A,QItem:K.A,QItemSection:R.A,QItemLabel:T.A}),O()(w,"directives",{Ripple:M.A})}}]);