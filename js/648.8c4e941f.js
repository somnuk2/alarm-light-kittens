"use strict";(globalThis["webpackChunkalarm_light_kittens"]=globalThis["webpackChunkalarm_light_kittens"]||[]).push([[648],{1648:(e,t,a)=>{a.r(t),a.d(t,{default:()=>O});a(939),a(4520),a(7049),a(1746),a(4635);var n=a(1347),l=a(8633),o=a(7763),r=a(4187),i=a(4495),s=a.n(i),c=a(3022),u=a(6568),m=a(6575);const d={class:"row justify-center"},p={class:"col-12 col-xl-10"},g={class:"column q-gutter-lg"},v={class:"text-h6 text-primary flex items-center"},f={class:"text-h6 text-primary flex items-center q-mb-md"},b={class:"q-gutter-y-md"},k={class:"row q-col-gutter-sm"},h={class:"col-6"},y={class:"col-6"},x={class:"row q-gutter-sm justify-center q-mt-md"},F={class:"text-subtitle2 q-mb-sm text-grey-8"},w={class:"row q-gutter-xs"},_="longan_geocode_cache",q={__name:"IndexPage",setup(e){const t=(0,c.A)(),a=(0,r.KR)(""),i=(0,r.KR)(""),q=(0,r.KR)(""),L=(0,r.KR)(""),A=(0,r.KR)(!1),S=(0,r.KR)(null),T=(0,r.KR)(null),B=(0,r.Kh)({}),C=(0,n.EW)(()=>Object.keys(B).sort().map(e=>({name:e,lat:B[e].lat,lng:B[e].lng,marker:B[e].marker}))),V=s().icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",shadowSize:[41,41]}),I=m.T,N=(0,r.KR)({type:"bounds",payload:null});function Q(){return t.screen.xs||t.screen.sm?16:17}function R(){return t.screen.xs?24:t.screen.sm?34:t.screen.md?46:60}function j(){return t.screen.xs?120:t.screen.sm?95:75}function K(e,t=Q(),a=null){S.value&&(S.value.flyTo(e,t,{duration:.7}),setTimeout(()=>{a&&a.openPopup(),S.value.panBy([0,-j()],{animate:!0})},750),N.value={type:"point",payload:{latlng:e}})}function M(e){if(!S.value)return;const t=R();S.value.fitBounds(e,{paddingTopLeft:[t,t],paddingBottomRight:[t,t]}),N.value={type:"bounds",payload:{bounds:e}}}function W(){if(S.value&&N.value?.payload)if("point"===N.value.type){const{latlng:e}=N.value.payload;K(e,Q())}else{const{bounds:e}=N.value.payload;M(e)}}function $(){S.value&&setTimeout(()=>{try{S.value.invalidateSize()}catch(e){}},60)}let z=null;function E(){clearTimeout(z),z=setTimeout(()=>{$(),setTimeout(()=>W(),80)},150)}function O(e){return String(e).replace(/\\/g,"\\\\").replace(/'/g,"\\'")}async function P(){S.value=(0,r.IG)(s().map("map").setView([18.8,99],8)),s().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(S.value),T.value=(0,r.IG)(s().layerGroup()).addTo(S.value);try{const e=await u.api.get("/api/markers"),t=e.data;t&&t.length>0?t.forEach(e=>U(e.name,e.lat,e.lng,!1,!1)):I.forEach(e=>U(e.name,e.lat,e.lng,!1,!1))}catch(e){console.error("Failed to fetch markers:",e),I.forEach(e=>U(e.name,e.lat,e.lng,!1,!1))}S.value.on("click",e=>{i.value=Number(e.latlng.lat.toFixed(6)),q.value=Number(e.latlng.lng.toFixed(6)),t.notify({color:"info",message:`เลือกพิกัด: ${i.value}, ${q.value}`,icon:"add_location",timeout:1500,position:"bottom-right"})}),$(),setTimeout(()=>X(),120)}function U(e,t,a,n=!1,l=!0){if(!e||isNaN(t)||isNaN(a))return;const o=e.trim();if(B[o]){const e=B[o].marker;e.setLatLng([t,a]),e.setPopupContent(G(o,t,a)),B[o].lat=t,B[o].lng=a}else{const e=s().marker([t,a],{icon:V}).addTo(T.value);e.bindPopup(G(o,t,a)),e.on("click",()=>e.openPopup()),B[o]={lat:t,lng:a,marker:(0,r.IG)(e)}}l&&X(),n&&S.value&&K([t,a],Q(),B[o]?.marker)}function G(e,t,a){const n=O(e);return`<div class="custom-popup">\n            <div style="font-weight: 600; font-size: 14px; margin-bottom: 4px;">${e}</div>\n            <div style="font-size: 12px; color: #666; margin-bottom: 8px;">\n              Lat: ${t.toFixed(6)}<br>Lng: ${a.toFixed(6)}\n            </div>\n            <button class="q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--rectangle text-negative q-focusable q-hoverable q-btn--dense"\n                    style="font-size: 11px; padding: 4px 8px; min-height: unset;"\n                    onclick="window.handleDeleteMarker('${n}')">\n              <span class="q-focus-helper"></span>\n              <span class="q-btn__content text-center col items-center q-anchor--skip justify-center row">\n                <i class="q-icon material-icons" aria-hidden="true" role="img">delete</i>\n                <span class="block q-ml-xs">ลบตำแหน่ง</span>\n              </span>\n            </button>\n          </div>`}function X(){const e=Object.values(B);if(0===e.length||!S.value)return;const t=s().featureGroup(e.map(e=>e.marker)),a=t.getBounds();if(1===e.length){const t=e[0];K([t.lat,t.lng],Q(),t.marker)}else M(a)}async function Z(){if(!a.value||""===i.value||""===q.value)return void t.notify({color:"negative",message:"กรุณากรอกชื่อสถานที่ และ Latitude/Longitude ให้ครบถ้วน",icon:"warning"});const e={name:a.value,lat:Number(i.value),lng:Number(q.value)};try{await u.api.post("/api/markers",e),U(e.name,e.lat,e.lng,!0,!0),t.notify({color:"positive",message:`บันทึก "${a.value}" เรียบร้อยแล้ว`,icon:"check_circle"})}catch(e){console.error("Error saving marker:",e),t.notify({color:"negative",message:"เกิดข้อผิดพลาดในการบันทึกข้อมูล",icon:"error"})}finally{$()}}function D(e){t.dialog({title:"ยืนยันการลบ",message:`คุณต้องการลบตำแหน่ง "${e}" ใช่หรือไม่?`,cancel:!0,persistent:!0,ok:{flat:!0,color:"negative",label:"ลบออก"}}).onOk(async()=>{await J(e)})}async function J(e){try{await u.api.delete(`/api/markers/${encodeURIComponent(e)}`),B[e]&&(T.value.removeLayer(B[e].marker),delete B[e]),X(),t.notify({color:"positive",message:`ลบ "${e}" เรียบร้อยแล้ว`,icon:"delete"})}catch(e){console.error("Error deleting marker:",e),t.notify({color:"negative",message:"เกิดข้อผิดพลาดในการลบข้อมูล",icon:"error"})}finally{$()}}function Y(){a.value="",i.value="",q.value="",L.value=""}function H(e){K([e.lat,e.lng],Q(),e.marker)}async function ee(){const e=L.value.trim();if(e){A.value=!0;try{const a=await te(e);if(a){i.value=Number(a.lat.toFixed(6)),q.value=Number(a.lng.toFixed(6));const e=t.screen.xs?15:16;K([a.lat,a.lng],e),t.notify({color:"positive",message:"พบตำแหน่งแล้ว",icon:"check"})}else t.notify({color:"negative",message:"ไม่พบพิกัดจากที่อยู่นี้",icon:"error"})}catch(e){console.error(e),t.notify({color:"negative",message:"เกิดข้อผิดพลาดในการเชื่อมต่อ",icon:"error"})}finally{A.value=!1,$()}}else t.notify({color:"warning",message:"กรุณากรอกที่อยู่สำหรับค้นหา",icon:"search"})}async function te(e){let t={};try{const e=localStorage.getItem(_);e&&(t=JSON.parse(e)||{})}catch(e){t={}}if(t[e])return t[e];const a="https://nominatim.openstreetmap.org/search?format=jsonv2&limit=1&q="+encodeURIComponent(e),n=await fetch(a,{headers:{Accept:"application/json"}});if(!n.ok)throw new Error("Geocoding error");const l=await n.json();if(!l||0===l.length)return null;const o=parseFloat(l[0].lat),r=parseFloat(l[0].lon);t[e]={lat:o,lng:r};try{localStorage.setItem(_,JSON.stringify(t))}catch(e){}return{lat:o,lng:r}}return(0,n.sV)(()=>{window.handleDeleteMarker=J}),(0,n.sV)(async()=>{await(0,n.dY)(),await P(),window.addEventListener("resize",E),setTimeout(()=>$(),250)}),(0,n.xo)(()=>{if(window.removeEventListener("resize",E),S.value)try{S.value.off(),S.value.remove()}catch(e){}}),(e,t)=>{const r=(0,n.g2)("q-badge"),s=(0,n.g2)("q-card-section"),c=(0,n.g2)("q-separator"),u=(0,n.g2)("q-card"),m=(0,n.g2)("q-icon"),_=(0,n.g2)("q-input"),S=(0,n.g2)("q-btn"),T=(0,n.g2)("q-item-section"),B=(0,n.g2)("q-item"),V=(0,n.g2)("q-item-label"),I=(0,n.g2)("q-list"),N=(0,n.g2)("q-scroll-area"),Q=(0,n.g2)("q-page"),R=(0,n.gN)("ripple");return(0,n.uX)(),(0,n.Wv)(Q,{class:"q-pa-md bg-grey-2"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",d,[(0,n.Lk)("div",p,[t[11]||(t[11]=(0,n.Lk)("h1",{class:"text-h4 text-center text-weight-bold q-mb-xs text-primary"}," กำหนดสถานที่ปลอดภัย ",-1)),t[12]||(t[12]=(0,n.Lk)("p",{class:"text-subtitle1 text-center text-grey-7 q-mb-lg"}," โรงเรียนวารีเชียงใหม่ (Northern Thailand) ",-1)),(0,n.Lk)("div",g,[(0,n.bF)(u,{class:"my-card map-card"},{default:(0,n.k6)(()=>[(0,n.bF)(s,{class:"q-pb-none"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",v,[(0,n.bF)(r,{color:"primary",class:"q-mr-sm text-subtitle2"},{default:(0,n.k6)(()=>[...t[4]||(t[4]=[(0,n.eW)("1",-1)])]),_:1}),t[5]||(t[5]=(0,n.eW)(" แผนที่ (LeafletJS + OSM) ",-1))]),t[6]||(t[6]=(0,n.Lk)("p",{class:"text-caption text-grey-7 q-ma-none"}," คลิกที่ Marker เพื่อดูรายละเอียด (Popup) ",-1))]),_:1}),(0,n.bF)(c),(0,n.bF)(s,{class:"map-body"},{default:(0,n.k6)(()=>[...t[7]||(t[7]=[(0,n.Lk)("div",{id:"map",class:"map-container rounded-borders shadow-1"},null,-1)])]),_:1})]),_:1}),(0,n.bF)(u,{class:"my-card q-mb-md"},{default:(0,n.k6)(()=>[(0,n.bF)(s,null,{default:(0,n.k6)(()=>[(0,n.Lk)("div",f,[(0,n.bF)(r,{color:"primary",class:"q-mr-sm text-subtitle2"},{default:(0,n.k6)(()=>[...t[8]||(t[8]=[(0,n.eW)("2",-1)])]),_:1}),t[9]||(t[9]=(0,n.eW)(" ฟอร์มบันทึกตำแหน่ง (Marker Form) ",-1))]),(0,n.Lk)("div",b,[(0,n.bF)(_,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),label:"ชื่อสถานที่ / อาคาร",placeholder:"เช่น อาคารที่ 1",outlined:"",dense:"","bg-color":"white",rules:[e=>!!e||"กรุณากรอกชื่อสถานที่"]},{prepend:(0,n.k6)(()=>[(0,n.bF)(m,{name:"place"})]),_:1},8,["modelValue","rules"]),(0,n.Lk)("div",k,[(0,n.Lk)("div",h,[(0,n.bF)(_,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),modelModifiers:{number:!0},type:"number",label:"Latitude",placeholder:"18.xxxx",outlined:"",dense:"","bg-color":"white",step:"0.000001"},null,8,["modelValue"])]),(0,n.Lk)("div",y,[(0,n.bF)(_,{modelValue:q.value,"onUpdate:modelValue":t[2]||(t[2]=e=>q.value=e),modelModifiers:{number:!0},type:"number",label:"Longitude",placeholder:"99.xxxx",outlined:"",dense:"","bg-color":"white",step:"0.000001"},null,8,["modelValue"])])]),(0,n.bF)(_,{modelValue:L.value,"onUpdate:modelValue":t[3]||(t[3]=e=>L.value=e),label:"ค้นหาจากชื่อที่อยู่ (Geocoding)",placeholder:"เช่น โรงเรียนวารี",outlined:"",dense:"","bg-color":"white",onKeyup:(0,l.jR)(ee,["enter"]),hint:"ใช้บริการ Nominatim (OpenStreetMap)"},{append:(0,n.k6)(()=>[(0,n.bF)(S,{flat:"",round:"",color:"primary",icon:"search",onClick:ee,loading:A.value},null,8,["loading"])]),_:1},8,["modelValue"]),(0,n.Lk)("div",x,[(0,n.bF)(S,{unelevated:"",color:"secondary","text-color":"white",icon:"my_location",label:"ค้นหาพิกัด",onClick:ee,loading:A.value,class:"col-auto"},null,8,["loading"]),(0,n.bF)(S,{unelevated:"",color:"positive",icon:"add_location_alt",label:"เพิ่ม/อัปเดต",onClick:Z,class:"col-auto"}),(0,n.bF)(S,{outline:"",color:"grey-7",label:"ล้างค่า",onClick:Y,class:"col-auto"})])])]),_:1}),(0,n.bF)(c),(0,n.bF)(s,null,{default:(0,n.k6)(()=>[(0,n.Lk)("div",F," รายการ Marker ("+(0,o.v_)(C.value.length)+") ",1),(0,n.bF)(N,{style:{height:"250px"}},{default:(0,n.k6)(()=>[(0,n.bF)(I,{separator:"",bordered:"",class:"rounded-borders bg-white"},{default:(0,n.k6)(()=>[0===C.value.length?((0,n.uX)(),(0,n.Wv)(B,{key:0},{default:(0,n.k6)(()=>[(0,n.bF)(T,{class:"text-center text-grey text-italic"},{default:(0,n.k6)(()=>[...t[10]||(t[10]=[(0,n.eW)(" ยังไม่มีข้อมูล ",-1)])]),_:1})]),_:1})):(0,n.Q3)("",!0),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(C.value,e=>(0,n.bo)(((0,n.uX)(),(0,n.Wv)(B,{key:e.name,clickable:"",onClick:t=>H(e)},{default:(0,n.k6)(()=>[(0,n.bF)(T,{avatar:""},{default:(0,n.k6)(()=>[(0,n.bF)(m,{name:"push_pin",color:"green-6"})]),_:1}),(0,n.bF)(T,null,{default:(0,n.k6)(()=>[(0,n.bF)(V,{class:"text-weight-medium"},{default:(0,n.k6)(()=>[(0,n.eW)((0,o.v_)(e.name),1)]),_:2},1024),(0,n.bF)(V,{caption:""},{default:(0,n.k6)(()=>[(0,n.eW)((0,o.v_)(e.lat.toFixed(5))+", "+(0,o.v_)(e.lng.toFixed(5)),1)]),_:2},1024)]),_:2},1024),(0,n.bF)(T,{side:""},{default:(0,n.k6)(()=>[(0,n.Lk)("div",w,[(0,n.bF)(S,{flat:"",round:"",color:"negative",icon:"delete",size:"sm",onClick:(0,l.D$)(t=>D(e.name),["stop"])},null,8,["onClick"]),(0,n.bF)(m,{name:"chevron_right",color:"grey-4"})])]),_:2},1024)]),_:2},1032,["onClick"])),[[R]])),128))]),_:1})]),_:1})]),_:1})]),_:1})]),t[13]||(t[13]=(0,n.Lk)("div",{class:"text-center q-mt-lg text-caption text-grey"}," Program by Vue.js & Quasar Framework | Leaflet.js | OpenStreetMap ",-1))])])]),_:1})}}};var L=a(2968),A=a(5013),S=a(3341),T=a(222),B=a(8155),C=a(6915),V=a(6067),I=a(3933),N=a(9039),Q=a(5460),R=a(3766),j=a(2589),K=a(4958),M=a(1420),W=a(4028),$=a(272),z=a.n($);const E=(0,L.A)(q,[["__scopeId","data-v-37f6eafa"]]),O=E;z()(q,"components",{QPage:A.A,QCard:S.A,QCardSection:T.A,QBadge:B.A,QSeparator:C.A,QInput:V.A,QIcon:I.A,QBtn:N.A,QScrollArea:Q.A,QList:R.A,QItem:j.A,QItemSection:K.A,QItemLabel:M.A}),z()(q,"directives",{Ripple:W.A})},6575:(e,t,a)=>{a.d(t,{T:()=>n,p:()=>l});const n=[{name:"อาคาร 1 อาคารอำนวยการ",lat:18.758769,lng:99.014645},{name:"อาคาร 2 อาคารสารสนเทศ",lat:18.758914,lng:99.015257},{name:"อาคาร 3 อาคารประถมศึกษา",lat:18.758361,lng:99.015129},{name:"อาคาร 4 อาคารมัธยมศึกษาตอนต้น",lat:18.757983,lng:99.015512},{name:"อาคาร 5 อาคารอนุบาล สระว่ายน้ำ โรงอาหาร",lat:18.758168,lng:99.015763},{name:"อาคาร 6 อาคารพลศึกษา ห้องสภานักเรียน",lat:18.757394,lng:99.015381},{name:"อาคาร 7 อาคารมัธยมศึกษาตอนปลาย ห้องสมุด",lat:18.75759,lng:99.015905},{name:"สนามฟุตซอล (Futsal)",lat:18.757955,lng:99.015097},{name:"สนามหญ้าจริง (Safe Zone)",lat:18.757826,lng:99.014679},{name:"สนามบาสเก็ดบอล",lat:18.757833,lng:99.015761}],l=[{nameA:"อาคาร 1 อาคารอำนวยการ",nameB:"อาคาร 3 อาคารประถมศึกษา",distance:50,time:2},{nameA:"อาคาร 3 อาคารประถมศึกษา",nameB:"สนามฟุตซอล (Futsal)",distance:40,time:1},{nameA:"สนามฟุตซอล (Futsal)",nameB:"สนามหญ้าจริง (Safe Zone)",distance:30,time:1},{nameA:"อาคาร 2 อาคารสารสนเทศ",nameB:"สนามฟุตซอล (Futsal)",distance:60,time:2},{nameA:"อาคาร 1 อาคารอำนวยการ",nameB:"อาคาร 2 อาคารสารสนเทศ",distance:15,time:1},{nameA:"อาคาร 2 อาคารสารสนเทศ",nameB:"อาคาร 3 อาคารประถมศึกษา",distance:45,time:2},{nameA:"อาคาร 4 อาคารมัธยมศึกษาตอนต้น",nameB:"สนามฟุตซอล (Futsal)",distance:25,time:1},{nameA:"อาคาร 5 อาคารอนุบาล สระว่ายน้ำ โรงอาหาร",nameB:"อาคาร 4 อาคารมัธยมศึกษาตอนต้น",distance:35,time:1},{nameA:"อาคาร 6 อาคารพลศึกษา ห้องสภานักเรียน",nameB:"สนามหญ้าจริง (Safe Zone)",distance:55,time:2},{nameA:"อาคาร 7 อาคารมัธยมศึกษาตอนปลาย ห้องสมุด",nameB:"สนามบาสเก็ดบอล",distance:40,time:2}]}}]);