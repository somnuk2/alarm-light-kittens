"use strict";(globalThis["webpackChunkalarm_light_kittens"]=globalThis["webpackChunkalarm_light_kittens"]||[]).push([[648],{1648:(e,t,a)=>{a.r(t),a.d(t,{default:()=>U});a(939),a(4520),a(7049),a(1746),a(4635);var l=a(1347),n=a(8633),o=a(7763),r=a(4187),i=a(4495),s=a.n(i),c=a(3022),u=a(6568),m=a(6575);const d={class:"row justify-center"},g={class:"col-12 col-xl-10"},p={class:"row q-col-gutter-lg"},v={class:"col-12 col-md-4"},b={class:"text-h6 text-primary flex items-center q-mb-md"},k={class:"q-gutter-y-md"},f={class:"row q-col-gutter-sm"},h={class:"col-6"},y={class:"col-6"},x={class:"row q-gutter-sm justify-center q-mt-md"},F={class:"text-subtitle2 q-mb-sm text-grey-8"},w={class:"row q-gutter-xs"},_={class:"col-12 col-md-8"},q={class:"text-h6 text-primary flex items-center"},L="longan_geocode_cache",A={__name:"IndexPage",setup(e){const t=(0,c.A)(),a=(0,r.KR)(""),i=(0,r.KR)(""),A=(0,r.KR)(""),C=(0,r.KR)(""),S=(0,r.KR)(!1),V=(0,r.KR)(null),B=(0,r.KR)(null),N=(0,r.Kh)({}),Q=(0,l.EW)(()=>Object.keys(N).sort().map(e=>({name:e,lat:N[e].lat,lng:N[e].lng,marker:N[e].marker}))),I=s().icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",shadowSize:[41,41]}),T=m.T;async function j(){V.value=s().map("map").setView([18.8,99],8),s().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(V.value),B.value=s().layerGroup().addTo(V.value);try{const e=await u.api.get("/api/markers"),t=e.data;t&&t.length>0?t.forEach(e=>{M(e.name,e.lat,e.lng,!1)}):T.forEach(e=>{M(e.name,e.lat,e.lng,!1)})}catch(e){console.error("Failed to fetch markers:",e),T.forEach(e=>{M(e.name,e.lat,e.lng,!1)})}V.value.on("click",e=>{i.value=Number(e.latlng.lat.toFixed(6)),A.value=Number(e.latlng.lng.toFixed(6)),t.notify({color:"info",message:`เลือกพิกัด: ${i.value}, ${A.value}`,icon:"add_location",timeout:1500,position:"bottom-right"})})}function M(e,t,a,l=!1){if(!e||isNaN(t)||isNaN(a))return;const n=e.trim();if(N[n]){const e=N[n].marker;e.setLatLng([t,a]),e.setPopupContent(R(n,t,a)),N[n].lat=t,N[n].lng=a}else{const e=s().marker([t,a],{icon:I}).addTo(B.value);e.bindPopup(R(n,t,a)),e.on("click",()=>{e.openPopup()}),N[n]={lat:t,lng:a,marker:(0,r.IG)(e)}}W(),l&&V.value&&(V.value.flyTo([t,a],17,{duration:.8}),N[n]&&N[n].marker&&setTimeout(()=>{N[n].marker.openPopup()},800))}function R(e,t,a){return`<div class="custom-popup">\n             <div style="font-weight: 600; font-size: 14px; margin-bottom: 4px;">${e}</div>\n             <div style="font-size: 12px; color: #666; margin-bottom: 8px;">\n               Lat: ${t.toFixed(6)}<br>Lng: ${a.toFixed(6)}\n             </div>\n             <button class="q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--rectangle text-negative q-focusable q-hoverable q-btn--dense"\n                     style="font-size: 11px; padding: 4px 8px; min-height: unset;"\n                     onclick="window.handleDeleteMarker('${e.replace(/'/g,"\\'")} ')">\n               <span class="q-focus-helper"></span>\n               <span class="q-btn__content text-center col items-center q-anchor--skip justify-center row">\n                 <i class="q-icon material-icons" aria-hidden="true" role="img">delete</i>\n                 <span class="block q-ml-xs">ลบตำแหน่ง</span>\n               </span>\n             </button>\n           </div>`}function W(){const e=Object.values(N);if(0===e.length||!V.value)return;const t=s().featureGroup(e.map(e=>e.marker));1===e.length?V.value.setView(t.getBounds().getCenter(),17):V.value.fitBounds(t.getBounds().pad(.2))}async function $(){if(!a.value||""===i.value||""===A.value)return void t.notify({color:"negative",message:"กรุณากรอกชื่อสถานที่ และ Latitude/Longitude ให้ครบถ้วน",icon:"warning"});const e={name:a.value,lat:Number(i.value),lng:Number(A.value)};try{await u.api.post("/api/markers",e),M(e.name,e.lat,e.lng,!0),t.notify({color:"positive",message:`บันทึก "${a.value}" เรียบร้อยแล้ว`,icon:"check_circle"})}catch(e){console.error("Error saving marker:",e),t.notify({color:"negative",message:"เกิดข้อผิดพลาดในการบันทึกข้อมูล",icon:"error"})}}function K(e){t.dialog({title:"ยืนยันการลบ",message:`คุณต้องการลบตำแหน่ง "${e}" ใช่หรือไม่?`,cancel:!0,persistent:!0,ok:{flat:!0,color:"negative",label:"ลบออก"}}).onOk(async()=>{await O(e)}).onCancel(()=>{console.log("Delete cancelled")})}async function O(e){try{await u.api.delete(`/api/markers/${encodeURIComponent(e)}`),N[e]&&(B.value.removeLayer(N[e].marker),delete N[e]),W(),t.notify({color:"positive",message:`ลบ "${e}" เรียบร้อยแล้ว`,icon:"delete"})}catch(e){console.error("Error deleting marker:",e),t.notify({color:"negative",message:"เกิดข้อผิดพลาดในการลบข้อมูล",icon:"error"})}}function P(){a.value="",i.value="",A.value="",C.value=""}function z(e){V.value&&(V.value.flyTo([e.lat,e.lng],17,{duration:.7}),e.marker&&e.marker.openPopup())}async function E(){const e=C.value.trim();if(e){S.value=!0;try{const a=await U(e);a?(i.value=Number(a.lat.toFixed(6)),A.value=Number(a.lng.toFixed(6)),V.value&&V.value.flyTo([a.lat,a.lng],15,{duration:.8}),t.notify({color:"positive",message:"พบตำแหน่งแล้ว",icon:"check"})):t.notify({color:"negative",message:"ไม่พบพิกัดจากที่อยู่นี้",icon:"error"})}catch(e){console.error(e),t.notify({color:"negative",message:"เกิดข้อผิดพลาดในการเชื่อมต่อ",icon:"error"})}finally{S.value=!1}}else t.notify({color:"warning",message:"กรุณากรอกที่อยู่สำหรับค้นหา",icon:"search"})}async function U(e){let t={};try{const e=localStorage.getItem(L);e&&(t=JSON.parse(e)||{})}catch(e){t={}}if(t[e])return t[e];const a="https://nominatim.openstreetmap.org/search?format=jsonv2&limit=1&q="+encodeURIComponent(e),l=await fetch(a,{headers:{Accept:"application/json"}});if(!l.ok)throw new Error("Geocoding error");const n=await l.json();if(!n||0===n.length)return null;const o=parseFloat(n[0].lat),r=parseFloat(n[0].lon);t[e]={lat:o,lng:r};try{localStorage.setItem(L,JSON.stringify(t))}catch(e){}return{lat:o,lng:r}}return(0,l.sV)(()=>{window.handleDeleteMarker=O}),(0,l.sV)(()=>{j()}),(e,t)=>{const r=(0,l.g2)("q-badge"),s=(0,l.g2)("q-icon"),c=(0,l.g2)("q-input"),u=(0,l.g2)("q-btn"),m=(0,l.g2)("q-card-section"),L=(0,l.g2)("q-separator"),V=(0,l.g2)("q-item-section"),B=(0,l.g2)("q-item"),N=(0,l.g2)("q-item-label"),I=(0,l.g2)("q-list"),T=(0,l.g2)("q-scroll-area"),j=(0,l.g2)("q-card"),M=(0,l.g2)("q-page"),R=(0,l.gN)("ripple");return(0,l.uX)(),(0,l.Wv)(M,{class:"q-pa-md bg-grey-2"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",d,[(0,l.Lk)("div",g,[t[11]||(t[11]=(0,l.Lk)("h1",{class:"text-h4 text-center text-weight-bold q-mb-xs text-primary"},"กำหนดสถานที่ปลอดภัย",-1)),t[12]||(t[12]=(0,l.Lk)("p",{class:"text-subtitle1 text-center text-grey-7 q-mb-lg"},"โรงเรียนวารีเชียงใหม่ (Northern Thailand)",-1)),(0,l.Lk)("div",p,[(0,l.Lk)("div",v,[(0,l.bF)(j,{class:"my-card q-mb-md"},{default:(0,l.k6)(()=>[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[(0,l.Lk)("div",b,[(0,l.bF)(r,{color:"primary",class:"q-mr-sm text-subtitle2"},{default:(0,l.k6)(()=>[...t[4]||(t[4]=[(0,l.eW)("1",-1)])]),_:1}),t[5]||(t[5]=(0,l.eW)(" ฟอร์มบันทึกตำแหน่ง (Marker Form) ",-1))]),(0,l.Lk)("div",k,[(0,l.bF)(c,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),label:"ชื่อสถานที่ / อาคาร",placeholder:"เช่น อาคารที่ 1",outlined:"",dense:"","bg-color":"white",rules:[e=>!!e||"กรุณากรอกชื่อสถานที่"]},{prepend:(0,l.k6)(()=>[(0,l.bF)(s,{name:"place"})]),_:1},8,["modelValue","rules"]),(0,l.Lk)("div",f,[(0,l.Lk)("div",h,[(0,l.bF)(c,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),modelModifiers:{number:!0},type:"number",label:"Latitude",placeholder:"18.xxxx",outlined:"",dense:"","bg-color":"white",step:"0.000001"},null,8,["modelValue"])]),(0,l.Lk)("div",y,[(0,l.bF)(c,{modelValue:A.value,"onUpdate:modelValue":t[2]||(t[2]=e=>A.value=e),modelModifiers:{number:!0},type:"number",label:"Longitude",placeholder:"99.xxxx",outlined:"",dense:"","bg-color":"white",step:"0.000001"},null,8,["modelValue"])])]),(0,l.bF)(c,{modelValue:C.value,"onUpdate:modelValue":t[3]||(t[3]=e=>C.value=e),label:"ค้นหาจากชื่อที่อยู่ (Geocoding)",placeholder:"เช่น โรงเรียนวารี",outlined:"",dense:"","bg-color":"white",onKeyup:(0,n.jR)(E,["enter"]),hint:"ใช้บริการ Nominatim (OpenStreetMap)"},{append:(0,l.k6)(()=>[(0,l.bF)(u,{flat:"",round:"",color:"primary",icon:"search",onClick:E,loading:S.value},null,8,["loading"])]),_:1},8,["modelValue"]),(0,l.Lk)("div",x,[(0,l.bF)(u,{unelevated:"",color:"secondary","text-color":"white",icon:"my_location",label:"ค้นหาพิกัด",onClick:E,loading:S.value,class:"col-auto"},null,8,["loading"]),(0,l.bF)(u,{unelevated:"",color:"positive",icon:"add_location_alt",label:"เพิ่ม/อัปเดต",onClick:$,class:"col-auto"}),(0,l.bF)(u,{outline:"",color:"grey-7",label:"ล้างค่า",onClick:P,class:"col-auto"})])])]),_:1}),(0,l.bF)(L),(0,l.bF)(m,null,{default:(0,l.k6)(()=>[(0,l.Lk)("div",F," รายการ Marker ("+(0,o.v_)(Q.value.length)+") ",1),(0,l.bF)(T,{style:{height:"250px"}},{default:(0,l.k6)(()=>[(0,l.bF)(I,{separator:"",bordered:"",class:"rounded-borders bg-white"},{default:(0,l.k6)(()=>[0===Q.value.length?((0,l.uX)(),(0,l.Wv)(B,{key:0},{default:(0,l.k6)(()=>[(0,l.bF)(V,{class:"text-center text-grey text-italic"},{default:(0,l.k6)(()=>[...t[6]||(t[6]=[(0,l.eW)(" ยังไม่มีข้อมูล ",-1)])]),_:1})]),_:1})):(0,l.Q3)("",!0),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(Q.value,e=>(0,l.bo)(((0,l.uX)(),(0,l.Wv)(B,{key:e.name,clickable:"",onClick:t=>z(e)},{default:(0,l.k6)(()=>[(0,l.bF)(V,{avatar:""},{default:(0,l.k6)(()=>[(0,l.bF)(s,{name:"push_pin",color:"green-6"})]),_:1}),(0,l.bF)(V,null,{default:(0,l.k6)(()=>[(0,l.bF)(N,{class:"text-weight-medium"},{default:(0,l.k6)(()=>[(0,l.eW)((0,o.v_)(e.name),1)]),_:2},1024),(0,l.bF)(N,{caption:""},{default:(0,l.k6)(()=>[(0,l.eW)((0,o.v_)(e.lat.toFixed(5))+", "+(0,o.v_)(e.lng.toFixed(5)),1)]),_:2},1024)]),_:2},1024),(0,l.bF)(V,{side:""},{default:(0,l.k6)(()=>[(0,l.Lk)("div",w,[(0,l.bF)(u,{flat:"",round:"",color:"negative",icon:"delete",size:"sm",onClick:(0,n.D$)(t=>K(e.name),["stop"])},null,8,["onClick"]),(0,l.bF)(s,{name:"chevron_right",color:"grey-4"})])]),_:2},1024)]),_:2},1032,["onClick"])),[[R]])),128))]),_:1})]),_:1})]),_:1})]),_:1})]),(0,l.Lk)("div",_,[(0,l.bF)(j,{class:"my-card fit"},{default:(0,l.k6)(()=>[(0,l.bF)(m,{class:"q-pb-none"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",q,[(0,l.bF)(r,{color:"primary",class:"q-mr-sm text-subtitle2"},{default:(0,l.k6)(()=>[...t[7]||(t[7]=[(0,l.eW)("2",-1)])]),_:1}),t[8]||(t[8]=(0,l.eW)(" แผนที่ (LeafletJS + OSM) ",-1))]),t[9]||(t[9]=(0,l.Lk)("p",{class:"text-caption text-grey-7 q-ma-none"}," คลิกที่ Marker เพื่อดูรายละเอียด (Popup) ",-1))]),_:1}),(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...t[10]||(t[10]=[(0,l.Lk)("div",{id:"map",class:"rounded-borders shadow-1",style:{height:"600px",width:"100%","z-index":"1"}},null,-1)])]),_:1})]),_:1})])]),t[13]||(t[13]=(0,l.Lk)("div",{class:"text-center q-mt-lg text-caption text-grey"}," Program by Vue.js & Quasar Framework | Leaflet.js | OpenStreetMap ",-1))])])]),_:1})}}};var C=a(2968),S=a(5013),V=a(3341),B=a(222),N=a(8155),Q=a(6067),I=a(3933),T=a(9039),j=a(6915),M=a(5460),R=a(3766),W=a(2589),$=a(4958),K=a(1420),O=a(4028),P=a(272),z=a.n(P);const E=(0,C.A)(A,[["__scopeId","data-v-1082f380"]]),U=E;z()(A,"components",{QPage:S.A,QCard:V.A,QCardSection:B.A,QBadge:N.A,QInput:Q.A,QIcon:I.A,QBtn:T.A,QSeparator:j.A,QScrollArea:M.A,QList:R.A,QItem:W.A,QItemSection:$.A,QItemLabel:K.A}),z()(A,"directives",{Ripple:O.A})},6575:(e,t,a)=>{a.d(t,{T:()=>l,p:()=>n});const l=[{name:"อาคาร 1 อาคารอำนวยการ",lat:18.758769,lng:99.014645},{name:"อาคาร 2 อาคารสารสนเทศ",lat:18.758914,lng:99.015257},{name:"อาคาร 3 อาคารประถมศึกษา",lat:18.758361,lng:99.015129},{name:"อาคาร 4 อาคารมัธยมศึกษาตอนต้น",lat:18.757983,lng:99.015512},{name:"อาคาร 5 อาคารอนุบาล สระว่ายน้ำ โรงอาหาร",lat:18.758168,lng:99.015763},{name:"อาคาร 6 อาคารพลศึกษา ห้องสภานักเรียน",lat:18.757394,lng:99.015381},{name:"อาคาร 7 อาคารมัธยมศึกษาตอนปลาย ห้องสมุด",lat:18.75759,lng:99.015905},{name:"สนามฟุตซอล (Futsal)",lat:18.757955,lng:99.015097},{name:"สนามหญ้าจริง (Safe Zone)",lat:18.757826,lng:99.014679},{name:"สนามบาสเก็ดบอล",lat:18.757833,lng:99.015761}],n=[{nameA:"อาคาร 1 อาคารอำนวยการ",nameB:"อาคาร 3 อาคารประถมศึกษา",distance:50,time:2},{nameA:"อาคาร 3 อาคารประถมศึกษา",nameB:"สนามฟุตซอล (Futsal)",distance:40,time:1},{nameA:"สนามฟุตซอล (Futsal)",nameB:"สนามหญ้าจริง (Safe Zone)",distance:30,time:1},{nameA:"อาคาร 2 อาคารสารสนเทศ",nameB:"สนามฟุตซอล (Futsal)",distance:60,time:2},{nameA:"อาคาร 1 อาคารอำนวยการ",nameB:"อาคาร 2 อาคารสารสนเทศ",distance:15,time:1},{nameA:"อาคาร 2 อาคารสารสนเทศ",nameB:"อาคาร 3 อาคารประถมศึกษา",distance:45,time:2},{nameA:"อาคาร 4 อาคารมัธยมศึกษาตอนต้น",nameB:"สนามฟุตซอล (Futsal)",distance:25,time:1},{nameA:"อาคาร 5 อาคารอนุบาล สระว่ายน้ำ โรงอาหาร",nameB:"อาคาร 4 อาคารมัธยมศึกษาตอนต้น",distance:35,time:1},{nameA:"อาคาร 6 อาคารพลศึกษา ห้องสภานักเรียน",nameB:"สนามหญ้าจริง (Safe Zone)",distance:55,time:2},{nameA:"อาคาร 7 อาคารมัธยมศึกษาตอนปลาย ห้องสมุด",nameB:"สนามบาสเก็ดบอล",distance:40,time:2}]}}]);