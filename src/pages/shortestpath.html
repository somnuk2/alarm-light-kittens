<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Shortest Path Buildings</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f7fb;
      color: #222;
    }
    .container {
      max-width: 1100px;
      margin: 24px auto;
      padding: 24px;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    }
    h1 {
      margin-top: 0;
      font-size: 1.5rem;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      margin-bottom: 16px;
      padding: 12px 16px;
      background: #f0f3fa;
      border-radius: 12px;
    }
    .control-group {
      display: flex;
      flex-direction: column;
      font-size: 0.9rem;
      min-width: 160px;
    }
    label {
      margin-bottom: 4px;
      color: #555;
    }
    select {
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #c7d2e5;
      font-size: 0.9rem;
      background: #fff;
    }
    button {
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      font-size: 0.95rem;
      cursor: pointer;
      background: #2563eb;
      color: #fff;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(37,99,235,0.4);
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
    }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(37,99,235,0.5);
      background: #1d4ed8;
    }
    button:active {
      transform: translateY(0);
      box-shadow: 0 3px 10px rgba(37,99,235,0.4);
    }
    #result {
      margin-top: 12px;
      padding: 10px 14px;
      border-radius: 10px;
      background: #eff6ff;
      font-size: 0.95rem;
      line-height: 1.5;
    }
    #canvas-wrapper {
      margin-top: 20px;
      padding: 16px;
      border-radius: 14px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }
    svg {
      width: 100%;
      height: 550px;
      border-radius: 12px;
      background: #ffffff;
    }
    .edge {
      stroke: #cbd5e1;
      stroke-width: 2;
      transition: stroke 0.15s ease, stroke-width 0.15s ease, opacity 0.15s ease;
    }
    .edge-label {
      font-size: 0.7rem;
      fill: #6b7280;
      pointer-events: none;
    }
    .node {
      fill: #0ea5e9;
      stroke: #e0f2fe;
      stroke-width: 3;
      transition: fill 0.15s ease, r 0.15s ease, stroke-width 0.15s ease;
    }
    .node-label {
      font-size: 0.75rem;
      fill: #111827;
      text-shadow: 0 1px 2px #fff;
    }
    .edge.highlight {
      stroke: #2563eb;
      stroke-width: 4;
      opacity: 0.95;
    }
    .node.highlight {
      fill: #f97316;
      stroke-width: 4;
      r: 9;
    }
    .legend {
      margin-top: 8px;
      font-size: 0.8rem;
      color: #6b7280;
      display: flex;
      gap: 14px;
      align-items: center;
      flex-wrap: wrap;
    }
    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .legend-line,
    .legend-line-highlight {
      width: 30px;
      height: 3px;
      border-radius: 999px;
    }
    .legend-line {
      background: #cbd5e1;
    }
    .legend-line-highlight {
      background: #2563eb;
    }
    .legend-node,
    .legend-node-highlight {
      width: 11px;
      height: 11px;
      border-radius: 50%;
    }
    .legend-node {
      background: #0ea5e9;
      border: 2px solid #e0f2fe;
    }
    .legend-node-highlight {
      background: #f97316;
      border: 2px solid #fed7aa;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>กราฟเส้นทางระหว่างอาคาร &amp; จุดสำคัญ (Shortest Path)</h1>

    <div class="controls">
      <div class="control-group">
        <label for="startSelect">จุดเริ่มต้น (Building A)</label>
        <select id="startSelect"></select>
      </div>
      <div class="control-group">
        <label for="endSelect">จุดปลายทาง (Building B)</label>
        <select id="endSelect"></select>
      </div>
      <div class="control-group">
        <label for="weightType">เกณฑ์ในการหาเส้นทาง</label>
        <select id="weightType">
          <option value="distance">ระยะทาง (เมตร)</option>
          <option value="time">เวลา (นาที)</option>
        </select>
      </div>
      <button id="runBtn">คำนวณเส้นทางสั้นที่สุด</button>
    </div>

    <div id="result">
      เลือกจุดเริ่มต้นและจุดปลายทาง จากนั้นกดปุ่ม “คำนวณเส้นทางสั้นที่สุด”
    </div>

    <div id="canvas-wrapper">
      <svg id="graph" viewBox="0 0 800 550"></svg>
      <div class="legend">
        <div class="legend-item">
          <div class="legend-line"></div> เส้นเชื่อมปกติ
        </div>
        <div class="legend-item">
          <div class="legend-line-highlight"></div> เส้นทางที่สั้นที่สุด
        </div>
        <div class="legend-item">
          <div class="legend-node"></div> ตำแหน่งโหนด
        </div>
        <div class="legend-item">
          <div class="legend-node-highlight"></div> โหนดอยู่ในเส้นทางที่สั้นที่สุด
        </div>
      </div>
    </div>
  </div>

  <script>
    // ข้อมูลโหนด (ใช้ lat / long จากตาราง)
    const nodes = {
      "อาคาร 1": { lat: 18.758769, lng: 99.014645 },
      "อาคาร 2": { lat: 18.758914, lng: 99.015257 },
      "อาคาร 3": { lat: 18.758361, lng: 99.015129 },
      "อาคาร 4": { lat: 18.757983, lng: 99.015512 },
      "อาคาร 5": { lat: 18.758168, lng: 99.015763 },
      "อาคาร 6": { lat: 18.757394, lng: 99.015381 },
      "อาคาร 7": { lat: 18.75759, lng: 99.015905 },
      "futsal": { lat: 18.757955, lng: 99.015097 },
      "สนามหญ้าจริง (safe zone)": { lat: 18.757826, lng: 99.014679 },
      "สนามบาสเก็ดบอล": { lat: 18.757833, lng: 99.015761 }
    };

    // ข้อมูลเส้นเชื่อม (edge) จากตาราง
    const edges = [
      { a: "อาคาร 1", b: "อาคาร 3", distance: 20, time: 20 },
      { a: "อาคาร 3", b: "futsal", distance: 15, time: 15 },
      { a: "futsal", b: "สนามหญ้าจริง (safe zone)", distance: 11, time: 11 },
      { a: "อาคาร 2", b: "futsal", distance: 20, time: 20 },
      { a: "อาคาร 1", b: "อาคาร 2", distance: 5, time: 5 },
      { a: "อาคาร 2", b: "อาคาร 3", distance: 20, time: 20 },
      { a: "อาคาร 4", b: "futsal", distance: 10, time: 10 },
      { a: "อาคาร 5", b: "อาคาร 4", distance: 12, time: 12 },
      { a: "อาคาร 6", b: "สนามหญ้าจริง (safe zone)", distance: 20, time: 20 },
      { a: "อาคาร 7", b: "สนามบาสเก็ดบอล", distance: 15, time: 15 },
      { a: "สนามบาสเก็ดบอล", b: "อาคาร 4", distance: 10, time: 10 },
      { a: "อาคาร 4", b: "อาคาร 6", distance: 5, time: 5 },
      { a: "อาคาร 7", b: "อาคาร 6", distance: 10, time: 10 }
    ];

    // adjacency list สำหรับใช้ใน Dijkstra
    const adjacency = {};

    function buildGraph() {
      const nodeNames = Object.keys(nodes);
      nodeNames.forEach(name => {
        adjacency[name] = [];
      });

      edges.forEach(e => {
        adjacency[e.a].push({ node: e.b, distance: e.distance, time: e.time });
        adjacency[e.b].push({ node: e.a, distance: e.distance, time: e.time }); // undirected
      });
    }

    // แปลง lat/lng ให้เป็นพิกัด x,y บน SVG
    function computeLayout() {
      const padding = 60;
      const width = 800;
      const height = 550;

      let minLat = Infinity, maxLat = -Infinity;
      let minLng = Infinity, maxLng = -Infinity;

      for (const name in nodes) {
        const p = nodes[name];
        if (p.lat < minLat) minLat = p.lat;
        if (p.lat > maxLat) maxLat = p.lat;
        if (p.lng < minLng) minLng = p.lng;
        if (p.lng > maxLng) maxLng = p.lng;
      }

      const latRange = maxLat - minLat || 1;
      const lngRange = maxLng - minLng || 1;

      for (const name in nodes) {
        const p = nodes[name];
        const x = ((p.lng - minLng) / lngRange) * (width - 2 * padding) + padding;
        const y = height - (((p.lat - minLat) / latRange) * (height - 2 * padding) + padding);
        p.x = x;
        p.y = y;
      }
    }

    function drawGraph() {
      const svg = document.getElementById("graph");
      svg.innerHTML = ""; // เคลียร์ก่อน

      // วาดเส้น (edges)
      edges.forEach(e => {
        const p1 = nodes[e.a];
        const p2 = nodes[e.b];

        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("x1", p1.x);
        line.setAttribute("y1", p1.y);
        line.setAttribute("x2", p2.x);
        line.setAttribute("y2", p2.y);
        line.setAttribute("class", "edge");
        svg.appendChild(line);
        e.element = line; // เอาไว้ใช้ตอน highlight

        // label ระยะทางที่กลางเส้น
        const midX = (p1.x + p2.x) / 2;
        const midY = (p1.y + p2.y) / 2;

        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", midX);
        text.setAttribute("y", midY - 4);
        text.setAttribute("class", "edge-label");
        text.setAttribute("text-anchor", "middle");
        text.textContent = e.distance + " ม.";
        svg.appendChild(text);
      });

      // วาดโหนด (nodes)
      for (const name in nodes) {
        const p = nodes[name];

        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", p.x);
        circle.setAttribute("cy", p.y);
        circle.setAttribute("r", 7);
        circle.setAttribute("class", "node");
        svg.appendChild(circle);
        p.element = circle;

        // label ชื่อโหนด
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", p.x);
        label.setAttribute("y", p.y - 10);
        label.setAttribute("class", "node-label");
        label.setAttribute("text-anchor", "middle");
        label.textContent = name;
        svg.appendChild(label);
      }
    }

    function populateSelects() {
      const startSelect = document.getElementById("startSelect");
      const endSelect = document.getElementById("endSelect");
      const nodeNames = Object.keys(nodes).sort();

      nodeNames.forEach(name => {
        const opt1 = document.createElement("option");
        opt1.value = name;
        opt1.textContent = name;
        startSelect.appendChild(opt1);

        const opt2 = document.createElement("option");
        opt2.value = name;
        opt2.textContent = name;
        endSelect.appendChild(opt2.cloneNode(true));
      });

      // ค่า default
      startSelect.value = "อาคาร 1";
      endSelect.value = "สนามหญ้าจริง (safe zone)";
    }

    // Dijkstra algorithm
    function dijkstra(start, end, weightField) {
      const dist = {};
      const prev = {};
      const visited = new Set();
      const nodesList = Object.keys(adjacency);

      nodesList.forEach(n => dist[n] = Infinity);
      dist[start] = 0;

      while (true) {
        let u = null;
        let minDist = Infinity;

        for (const n of nodesList) {
          if (!visited.has(n) && dist[n] < minDist) {
            minDist = dist[n];
            u = n;
          }
        }

        if (u === null) break;    // ไม่มีโหนดให้เยี่ยมต่อ
        if (u === end) break;     // ถึงปลายทางแล้ว

        visited.add(u);

        for (const edge of adjacency[u]) {
          const alt = dist[u] + edge[weightField];
          if (alt < dist[edge.node]) {
            dist[edge.node] = alt;
            prev[edge.node] = u;
          }
        }
      }

      if (dist[end] === Infinity) {
        return { distance: Infinity, path: [] };
      }

      const path = [];
      let curr = end;
      while (curr !== undefined) {
        path.unshift(curr);
        curr = prev[curr];
      }
      return { distance: dist[end], path };
    }

    function clearHighlights() {
      edges.forEach(e => {
        if (e.element) e.element.classList.remove("highlight");
      });
      for (const name in nodes) {
        const p = nodes[name];
        if (p.element) p.element.classList.remove("highlight");
      }
    }

    function highlightPath(path) {
      clearHighlights();

      // highlight nodes
      path.forEach(name => {
        const p = nodes[name];
        if (p && p.element) {
          p.element.classList.add("highlight");
        }
      });

      // highlight edges along the path
      for (let i = 0; i < path.length - 1; i++) {
        const u = path[i];
        const v = path[i + 1];
        edges.forEach(e => {
          if (
            (e.a === u && e.b === v) ||
            (e.a === v && e.b === u)
          ) {
            if (e.element) e.element.classList.add("highlight");
          }
        });
      }
    }

    function runShortestPath() {
      const start = document.getElementById("startSelect").value;
      const end = document.getElementById("endSelect").value;
      const weightType = document.getElementById("weightType").value;
      const resultDiv = document.getElementById("result");

      if (start === end) {
        clearHighlights();
        if (nodes[start] && nodes[start].element) {
          nodes[start].element.classList.add("highlight");
        }
        resultDiv.innerHTML = `จุดเริ่มต้นและปลายทางเหมือนกัน: <strong>${start}</strong><br>ระยะทางรวม 0 เมตร`;
        return;
      }

      const { distance, path } = dijkstra(start, end, weightType);

      if (distance === Infinity || path.length === 0) {
        clearHighlights();
        resultDiv.textContent = "ไม่พบเส้นทางระหว่างสองจุดนี้";
        return;
      }

      highlightPath(path);

      const pathText = path.join(" → ");
      const unit = weightType === "distance" ? "เมตร" : "นาที";
      resultDiv.innerHTML =
        `เส้นทางที่สั้นที่สุดจาก <strong>${start}</strong> ไป <strong>${end}</strong><br>` +
        `เส้นทาง: ${pathText}<br>` +
        `ระยะทางรวม: <strong>${distance} ${unit}</strong>`;
    }

    function init() {
      buildGraph();
      computeLayout();
      drawGraph();
      populateSelects();
      document.getElementById("runBtn").addEventListener("click", runShortestPath);
    }

    window.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
